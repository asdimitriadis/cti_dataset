{
  "$id": "http://raw.githubusercontent.com/oasis-open/cti-stix2-json-schemas/stix2.1/schemas/observables/email-message.json",
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "title": "email-message",
  "description": "The Email Message Object represents an instance of an email message.",
  "type": "object",
  "properties": {
    "type": {
      "type": "string",
      "description": "The value of this property MUST be `email-message`.",
      "enum": [
        "email-message"
      ]
    },
    "id": {
      "type": "string",
      "description": "The id property universally and uniquely identifies this object.",
      "pattern": "^email-message--[0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[1-5][0-9a-fA-F]{3}-[89abAB][0-9a-fA-F]{3}-[0-9a-fA-F]{12}$"
    },
    "defanged": {
      "type": "boolean",
      "description": "Defines whether or not the data contained within the object has been defanged."
    },
    "spec_version": {
      "type": "string",
      "description": "The version of the STIX specification used to represent this object.",
      "enum": [
        "2.1"
      ]
    },
    "date": {
      "type": "string",
      "format": "date-time",
      "description": "Specifies the date/time that the email message was sent.",
      "pattern": "^[0-9]{4}-(0[1-9]|1[012])-(0[1-9]|[12][0-9]|3[01])T([01][0-9]|2[0-3]):([0-5][0-9]):([0-5][0-9]|60)(\\.[0-9]+)?Z$",
      "errorMessage": "must be in DD/MM/YYYY HH:mm:ss for instance 2016-01-20 12:31:12"
    },
    "content_type": {
      "type": "string",
      "description": "Specifies the value of the 'Content-Type' header of the email message."
    },
    "from_ref": {
      "description": "Specifies the value of the 'From:' header of the email message.",
      "type": "string",
      "pattern": "^email-addr--[0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[1-5][0-9a-fA-F]{3}-[89abAB][0-9a-fA-F]{3}-[0-9a-fA-F]{12}$"
    },
    "sender_ref": {
      "description": "Specifies the value of the 'From' field of the email message.",
      "type": "string",
      "pattern": "^email-addr--[0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[1-5][0-9a-fA-F]{3}-[89abAB][0-9a-fA-F]{3}-[0-9a-fA-F]{12}$"
    },
    "to_refs": {
      "type": "array",
      "description": "Specifies the mailboxes that are 'To:' recipients of the email message.",
      "items": {
        "type": "string",
        "title": "To Ref",
        "description": "Specifies the mailboxes that are 'To:' recipients of the email message.",
        "pattern": "^email-addr--[0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[1-5][0-9a-fA-F]{3}-[89abAB][0-9a-fA-F]{3}-[0-9a-fA-F]{12}$"
      }
    },
    "cc_refs": {
      "type": "array",
      "description": "Specifies the mailboxes that are 'CC:' recipients of the email message.",
      "items": {
        "type": "string",
        "title": "CC Ref",
        "description": "Specifies the mailboxes that are 'CC:' recipients of the email message.",
        "pattern": "^email-addr--[0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[1-5][0-9a-fA-F]{3}-[89abAB][0-9a-fA-F]{3}-[0-9a-fA-F]{12}$"
      }
    },
    "bcc_refs": {
      "type": "array",
      "description": "Specifies the mailboxes that are 'BCC:' recipients of the email message.",
      "items": {
        "type": "string",
        "title": "BCC Ref",
        "description": "Specifies the mailboxes that are 'BCC:' recipients of the email message.",
        "pattern": "^email-addr--[0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[1-5][0-9a-fA-F]{3}-[89abAB][0-9a-fA-F]{3}-[0-9a-fA-F]{12}$"
      }
    },
    "raw_email_ref": {
      "description": "Specifies the raw binary contents of the email message, including both the headers and body, as a reference to an Artifact Object.",
      "type": "string",
      "pattern": "^artifact--[0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[1-5][0-9a-fA-F]{3}-[89abAB][0-9a-fA-F]{3}-[0-9a-fA-F]{12}$"
    },
    "message_id": {
      "type": "string",
      "description": "Specifies the Message-ID field of the email message."
    },
    "subject": {
      "type": "string",
      "description": "Specifies the subject of the email message."
    },
    "body": {
      "type": "string",
      "description": "Specifies a string containing the email body. This field MAY only be used if is_multipart is false."
    },
    "received_lines": {
      "type": "array",
      "description": "Specifies one or more Received header fields that may be included in the email headers.",
      "items": {
        "type": "string",
        "title": "Received Line",
        "description": "Specifies one or more Received header fields that may be included in the email headers."
      }
    },
    "is_multipart": {
      "type": "boolean",
      "description": "Indicates whether the email body contains multiple MIME parts."
    },
    "body_multipart": {
      "type": "array",
      "description": "Specifies a list of the MIME parts that make up the email body. This property MAY only be used if is_multipart is true.",
      "items": {
        "type": "object",
        "properties": {
          "body": {
            "type": "string",
            "description": "Specifies the contents of the MIME part if the content_type is not provided OR starts with text/"
          },
          "body_raw_ref": {
            "type": "string",
            "description": "Specifies the contents of non-textual MIME parts, that is those whose content_type does not start with text/, as a reference to an Artifact Object or File Object.",
            "pattern": "^artifact--[0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[1-5][0-9a-fA-F]{3}-[89abAB][0-9a-fA-F]{3}-[0-9a-fA-F]{12}$|^file--[0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[1-5][0-9a-fA-F]{3}-[89abAB][0-9a-fA-F]{3}-[0-9a-fA-F]{12}$"
          },
          "content_type": {
            "type": "string",
            "description": "Specifies the value of the 'Content-Type' header field of the MIME part."
          },
          "content_disposition": {
            "type": "string",
            "description": "Specifies the value of the 'Content-Disposition' header field of the MIME part."
          }
        },
        "oneOf": [
          {
            "required": [
              "body"
            ]
          },
          {
            "required": [
              "body_raw_ref"
            ]
          }
        ]
      }
    }
  },
  "oneOf": [
    {
      "required": [
        "is_multipart"
      ],
      "not": {
        "required": [
          "body_multipart"
        ]
      }
    },
    {
      "required": [
        "is_multipart"
      ],
      "not": {
        "required": [
          "body"
        ]
      }
    }
  ],
  "required": [
    "type",
    "id",
    "CTIP_name",
    "imported",
    "CTIP_owner",
    "CTIP_state",
    "CTIP_modified"
  ]
}